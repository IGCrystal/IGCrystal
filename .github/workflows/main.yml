name: Update README Countdown

on:
  schedule:
    # æ¯å¤©UTCæ—¶é—´00:00è¿è¡Œ (åŒ—äº¬æ—¶é—´08:00)
    - cron: '0 0 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update-countdown:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Update countdown
      run: |
        # è®¾ç½®ç›®æ ‡æ—¥æœŸ (è¯·æ ¹æ®éœ€è¦ä¿®æ”¹è¿™ä¸ªæ—¥æœŸ)
        TARGET_DATE="2025-10-16"  # ç¤ºä¾‹ï¼š2025å¹´10æœˆ16æ—¥
        
        # è®¡ç®—å‰©ä½™å¤©æ•°
        CURRENT_DATE=$(date +%Y-%m-%d)
        DAYS_LEFT=$(( ($(date -d "$TARGET_DATE" +%s) - $(date -d "$CURRENT_DATE" +%s)) / 86400 ))
        
        # å¦‚æžœå€’è®¡æ—¶ç»“æŸï¼Œè®¾ç½®ä¸º0
        if [ $DAYS_LEFT -lt 0 ]; then
          DAYS_LEFT=0
        fi
        
        # æ›´æ–°READMEæ–‡ä»¶
        cat > README.md << EOF
        ## Hi there ðŸ‘‹
        æ­£åœ¨å®Œæˆè´¦å·åˆå¹¶ã€‚
        é¢„è®¡è¿˜æœ‰${DAYS_LEFT}å¤©ã€‚
        EOF
        
        echo "å‰©ä½™å¤©æ•°: $DAYS_LEFT"
        
    - name: Commit and push changes
      run: |
        git config --local user.email "cacheigcrystal@github.com"
        git config --local user.name "IGCrystal-Ghost"
        git add README.md
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
        if git diff --staged --quiet; then
          echo "æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æäº¤"
        else
          git commit -m "Update countdown: $(date '+%Y-%m-%d')"
          git push
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
